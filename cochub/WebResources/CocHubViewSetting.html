<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Build On Web</title>
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/layout_setting.css">
</head>
<body>
    <div id="Container">
	<div id="Header">
            <div id="HeaderTopLevel">
                <div id ="SearchText">
                    <form accept-charset="UTF-8" action="/search" id="top_search_form" method="get">
                        <input type="text" name="q" id="js-command-bar-field" placeholder="Search or type a command" tabindex="1" data-username="$BOW_TMPL_USER$">
                    </form>
                </div>
                <div id ="UserInfo">
                    <ul>
                        <li>
                            <a href="/users/$BOW_TMPL_USER$">
                                $BOW_TMPL_USER$
                            </a>
                        </li>
                        <li>
                            $BOW_TMPL_USER_LOGINOUT$
                        </li>
                    </ul>
                </div>
            </div>
            <div id="HeaderBottumLevel">
            </div>
        </div>
	<div id="ContentFrame">
            <div id="ProjectViewFrame">
                <div id="ProjectInfo">
                    <div id="ProjectRepo">
                        <label>
                            Repository of your project
                        </label>
                        <input type="text" id="ProjectRepoUri" onchange="ProjectRepoUriChanged(this.value)"/>
                        <canvas id="ProjectAutoDetectCanvas" width="20" height="20"></canvas>
                        <label>
                            branchs
                        </label>
                        <select id="ProjectRepoBranch">
                        </select>
                        <input type="text" id="ProjectName" value=""/>
                        <label>Build Type:</label>
                        <select id="ProjectBuildType">
                        </select>
                    </div>
                </div>
                <div id="ProjectProperty">
                </div>
            </div>
            <div id="ProjectSettingLog">
            </div>
	</div>   
        <div id="Footer">
            This site is created by Ma Eikei. All sources is hosted on <a href="https://github.com/maeikei/BuildOnWeb">github</a><br>
            Any question please contract me. <a href="mailto:maeikei@gmail.com">maeikei@gmail.com</a>
        </div>
    </div>
    <script src="ace/src-min-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
    <!--script src="js/ace_wrap.js" type="text/javascript" charset="utf-8"></script-->    
    <script type="text/javascript">
        var output = ace.edit("ProjectSettingLog");
        output.setTheme("ace/theme/terminal");
        output.getSession().setMode("ace/mode/text");
        output.setReadOnly(true);
        var path = window.location.pathname;
        var xmlHttpRequest = new XMLHttpRequest();
        xmlHttpRequest.onreadystatechange = function() {
            var READYSTATE_COMPLETED = 4;
            var HTTP_STATUS_OK = 200;
            if( xmlHttpRequest.readyState == READYSTATE_COMPLETED
                       && xmlHttpRequest.status == HTTP_STATUS_OK )
               {
                   console.log(xmlHttpRequest.responseText);
                   var obj = eval("(" + xmlHttpRequest.responseText + ")");
                   var branchmenu = document.getElementById("ProjectRepoBranch");
                   while (branchmenu.firstChild) {
                       branchmenu.removeChild(branchmenu.firstChild);
                   };
                   for (var i in obj.branches) {
                       /*console.log(obj.branches[i]);*/
                       var option = document.createElement("option");
                       option.setAttribute("value",obj.branches[i]);
                       option.innerHTML = obj.branches[i];
                       branchmenu.appendChild(option);
                   }
                   document.getElementById("ProjectName").setAttribute("value",obj.name);
                   
                   var buildTypeMenu = document.getElementById("ProjectBuildType");
                   while (buildTypeMenu.firstChild) {
                       buildTypeMenu.removeChild(buildTypeMenu.firstChild);
                   };
                    for (var i in obj.buildtype) {
                       /*console.log(obj.buildtype[i]);*/
                       var option = document.createElement("option");
                       option.setAttribute("value",obj.buildtype[i]);
                       option.innerHTML = obj.buildtype[i];
                       buildTypeMenu.appendChild(option);
                   }
                   output.setValue(obj.output,1);
                   output.gotoLine(1);
                   stopAnim();
               }
        }
        function ProjectRepoUriChanged(x){
            xmlHttpRequest.open('POST',path);
            xmlHttpRequest.setRequestHeader( 'Content-Type', 'application/x-www-form-urlencoded');
            xmlHttpRequest.send(JSON.stringify({"git":x}));
            startAnim();
        }
        
        /*animations*/
        var animationCounter = 0;
        function animLoop() {
            var canvas = document.getElementById('ProjectAutoDetectCanvas');
            var cc = canvas.getContext('2d');
            cc.beginPath();
            cc.arc(10, 10, 10, 0, Math.PI * 2, false);
            if( animationCounter != 1) {
                cc.fillStyle = 'red';
            }
            else {
                cc.fillStyle = 'green';
            }
            cc.fill();
            animationCounter += 1;
            animationCounter %= 2;
        }
        var animTimer;
        function startAnim(){
            animTimer = setInterval("animLoop()",400);
        }
        function stopAnim(){
            clearInterval(animTimer);
            var canvas = document.getElementById('ProjectAutoDetectCanvas');
            var cc = canvas.getContext('2d');
            cc.clearRect(0,0,20,20);
        }
    </script> 
</body>
</html>
